<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <!-- Updated viewport to prevent zooming -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aplikasi Kotak Kuadran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- QRious library for QR Code generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body {
            /* Set background to black and use Inter font */
            background-color: #000;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column; /* Changed to column to stack main-container and output */
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Ensure it takes full viewport height */
            margin: 0;
            overflow: hidden; /* Prevent scrollbars if content slightly overflows */
            /* Prevent text highlighting/selection */
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE/Edge */
            user-select: none; /* Standard */
        }

        /* Custom style for the main container to ensure it's a horizontal rectangle */
        .main-container {
            /* Responsive width, capped at 900px */
            width: min(90vw, 900px); 
            /* Height will automatically adjust to maintain 9:4 aspect ratio */
            aspect-ratio: 9 / 4; /* Fixed aspect ratio matching 900x400 images */
            height: auto; /* Ensure height is not overriding aspect-ratio */

            position: relative; /* For absolute positioning of the center box */
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2x2 grid for quadrants */
            grid-template-rows: repeat(2, 1fr);
            gap: 4px; /* Small gap between quadrants */
            background-color: rgba(51, 51, 51, 0.5); /* Semi-transparent dark gray for the gaps/borders */
            border-radius: 12px; /* Rounded corners for the main container */
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3); /* Subtle neon glow */
            z-index: 1; /* Ensure main-container is above the full-page background images */
        }

        /* Container for background images, now positioned fixed to the viewport */
        .background-image-viewer {
            position: fixed; /* Fixed to viewport */
            top: 0;
            left: 0;
            width: 100vw; /* Take full viewport width */
            height: 100vh; /* Take full viewport height */
            overflow: hidden; /* Hide overflowing images */
            z-index: -1; /* Send to back, behind everything else */
        }

        .image-slider {
            display: flex; /* Arrange images horizontally */
            width: 400vw; /* 4 images * 100vw each (3 placeholders + 1 QR) */
            height: 100vh; /* Take full viewport height */
            transition: transform 0.8s ease-in-out; /* Smooth sliding transition */
        }

        .image-slider img {
            width: 100vw; /* Each image takes 100vw of the slider's segment */
            height: 100vh; /* Each image takes 100vh of the slider's segment */
            object-fit: contain; /* Show full image, with letterboxing if aspect ratio doesn't match */
            flex-shrink: 0; /* Prevent images from shrinking */
        }

        .quadrant-box {
            display: flex;
            justify-content: center;
            align-items: center;
            /* Made background transparent/colorless */
            background-color: rgba(26, 26, 26, 0.2); /* Very subtle dark transparent tint */
            color: #00ffff; /* Neon cyan text */
            font-size: 3rem; /* Large font size for labels */
            font-weight: bold;
            border-radius: 8px; /* Rounded corners for individual boxes */
            transition: background-color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
            z-index: 2; /* Ensure boxes are above background images */
        }

        .quadrant-box:hover {
            background-color: #00ffff; /* Invert colors on hover */
            color: #1a1a1a;
            transform: scale(1.05); /* Slightly enlarge on hover */
        }

        .center-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); /* Center the box precisely */
            width: 30%; /* Size relative to the main container */
            height: 30%;
            /* Made background transparent/colorless */
            background-color: rgba(26, 26, 26, 0.2); /* Very subtle dark transparent tint */
            color: #ff00ff; /* Neon magenta for center */
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem; /* Even larger font for center label */
            font-weight: bold;
            /* Changed border-radius to make it a rectangle */
            border-radius: 8px; /* Matching the quadrant boxes for a rectangular shape */
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.7); /* Stronger neon glow */
            z-index: 2; /* Ensure it's above quadrants and background images */
            transition: background-color 0.3s ease, transform 0.3s ease;
            cursor: pointer;
        }

        .center-box:hover {
            background-color: #1a1a1a; /* Invert colors on hover */
            color: #ff00ff;
            transform: translate(-50%, -50%) scale(1.1); /* Enlarge more on hover */
        }

        .toggle-button {
            position: fixed; /* Position fixed relative to the viewport */
            bottom: 20px; /* 20px from the bottom */
            right: 20px; /* 20px from the right */
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            z-index: 100; /* Ensure it's above other content */
        }

        .toggle-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Background Image Carousel, now OUTSIDE main-container -->
    <div class="background-image-viewer" id="backgroundImageViewer">
        <div class="image-slider" id="imageSlider">
            <!-- Updated placeholder image sizes to landscape orientation (1920x1080) -->
            <img src="https://placehold.co/1920x1080/0000FF/FFFFFF?text=Gambar+1" alt="Gambar Latar Belakang 1">
            <img src="https://placehold.co/1920x1080/FF0000/FFFFFF?text=Gambar+2" alt="Gambar Latar Belakang 2">
            <img src="https://placehold.co/1920x1080/00FF00/FFFFFF?text=Gambar+3" alt="Gambar Latar Belakang 3">
            <!-- Placeholder for QR Code image (4th image) -->
            <img id="qrCodeImage" src="https://placehold.co/1920x1080/000000/FFFFFF?text=QR+Code+Akan+Muncul+Di+Sini" alt="QR Code Placeholder">
        </div>
    </div>

    <div class="main-container" id="mainContainer">
        <!-- Quadrant A (Top-Left) -->
        <div class="quadrant-box" id="boxA">A</div>
        <!-- Quadrant B (Top-Right) -->
        <div class="quadrant-box" id="boxB">B</div>
        <!-- Quadrant C (Bottom-Left) -->
        <div class="quadrant-box" id="boxC">C</div>
        <!-- Quadrant D (Bottom-Right) -->
        <div class="quadrant-box" id="boxD">D</div>
        
        <!-- Center Box E -->
        <div class="center-box" id="boxE">E</div>
    </div>

    <!-- Output display for encoded value -->
    <div id="swipeOutput" class="text-center text-white text-xl mt-4"></div>

    <!-- Toggle Button -->
    <button id="toggleInputButton" class="toggle-button">Sembunyikan Input</button>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const mainContainer = document.getElementById('mainContainer');
            // Removed individual box references as they are no longer needed for click events
            const swipeOutput = document.getElementById('swipeOutput');
            const imageSlider = document.getElementById('imageSlider');
            const qrCodeImage = document.getElementById('qrCodeImage');
            const backgroundImageViewer = document.getElementById('backgroundImageViewer');
            const images = document.querySelectorAll('.image-slider img');

            let totalImages = images.length;
            let currentImageIndex = 0;

            let inputSequence = [];
            const MAX_INPUT_LENGTH = 3;

            const encodingMap = {
                'a': 'Fl',
                'b': 'uC',
                'c': 'Xy',
                'd': 'zW',
                'e': 'Qr'
            };

            /**
             * Translates raw input characters into the secret ID format based on the encoding map.
             * It takes the first MAX_INPUT_LENGTH characters and translates them,
             * padding with 'Fl' if the input is shorter than MAX_INPUT_LENGTH.
             * @param {string} input - The raw input string (e.g., "abc").
             * @returns {string} The translated and padded secret ID.
             */
            function translateInputForSecretId(input) {
                let translated = '';
                const maxLength = 3; 
                
                // Use a local copy or reference the global one
                const encodingMapInternal = { 
                    'a': 'Fl',
                    'b': 'uC',
                    'c': 'Xy',
                    'd': 'zW',
                    'e': 'Qr'
                };

                for (let i = 0; i < input.length && i < maxLength; i++) {
                    const char = input[i].toLowerCase();
                    if (encodingMapInternal[char]) { 
                        translated += encodingMapInternal[char];
                    } else {
                        translated += encodingMapInternal['a']; // Default to 'Fl' if character not in map
                    }
                }
                
                // Pad the translated string with 'Fl' if it's shorter than maxLength * 2
                while (translated.length < maxLength * 2) { 
                    translated += encodingMapInternal['a']; 
                }
                return translated;
            }

            /**
             * Generates a QR code from a given URL and updates the source of the QR code image element.
             * @param {string} url - The URL to encode in the QR code.
             */
            function generateQRCodeImage(url) {
                const tempCanvas = document.createElement('canvas');
                const qrSize = 500; // A larger square size for better resolution
                tempCanvas.width = qrSize; 
                tempCanvas.height = qrSize;

                new QRious({
                    element: tempCanvas,
                    value: url,
                    size: qrSize, // Size of the QR code modules within the canvas
                    padding: 40 // Increased padding for a better quiet zone (e.g., 40 pixels)
                });

                qrCodeImage.src = tempCanvas.toDataURL(); // Set the src of the 4th image
                qrCodeImage.alt = "Generated QR Code";
            }

            /**
             * Slides the background image carousel to a specific image index.
             * @param {number} index - The index of the image to display (0-based).
             */
            function slideImage(index) {
                imageSlider.style.transition = 'transform 0.8s ease-in-out'; // Enable smooth transition
                imageSlider.style.transform = `translateX(-${index * 100}vw)`;
                currentImageIndex = index; // Update the global index
            }

            /**
             * Handles the input character. This will now be triggered by specific swipe gestures.
             * Adds the character to the sequence, updates the display, and generates QR code if sequence is complete.
             * @param {string} char - The character ('a', 'b', 'c', 'd', 'e') from the detected swipe.
             */
            function handleInput(char) {
                if (inputSequence.length < MAX_INPUT_LENGTH) {
                    inputSequence.push(char);
                    swipeOutput.textContent = `Input: ${inputSequence.join(', ').toUpperCase()}`;
                    
                    // Advance to the next placeholder image (Gambar 1 -> Gambar 2 -> Gambar 3)
                    // Only advance if we are still collecting inputs for the code (1st, 2nd, or 3rd input)
                    if (inputSequence.length <= MAX_INPUT_LENGTH) { 
                        currentImageIndex = (currentImageIndex + 1) % (totalImages - 1); // Cycle through 0, 1, 2
                        slideImage(currentImageIndex);
                    }
                }

                if (inputSequence.length === MAX_INPUT_LENGTH) {
                    const rawCode = inputSequence.join('');
                    const encodedCode = translateInputForSecretId(rawCode);
                    const qrLink = `https://atmamagic.vercel.app/smith-family.html?id=${encodedCode}`;
                    
                    swipeOutput.textContent = `Kode Lengkap: ${encodedCode} (QR Dibuat!)`;
                    console.log(`Kode gabungan: ${rawCode}, Kode terenkripsi: ${encodedCode}`);
                    console.log(`Link QR: ${qrLink}`);

                    generateQRCodeImage(qrLink);
                    
                    // Set currentImageIndex directly to the QR code image index (3)
                    currentImageIndex = totalImages - 1; // totalImages is 4, so index 3
                    slideImage(currentImageIndex); // Slide to the QR code image
                    
                    inputSequence = []; // Reset sequence after QR generation
                }
            }

            // --- Background Image Swipe Logic (on backgroundImageViewer) ---
            let backgroundTouchStartX = 0;
            let backgroundTouchStartY = 0;
            // Thresholds for background image swiping
            const BACKGROUND_SWIPE_THRESHOLD_X = 50; // Minimum horizontal pixels for a swipe to register
            const BACKGROUND_MAX_VERTICAL_DEVIATION = 75; // Maximum vertical deviation allowed for a horizontal swipe

            backgroundImageViewer.addEventListener('touchstart', (e) => {
                backgroundTouchStartX = e.touches[0].clientX;
                backgroundTouchStartY = e.touches[0].clientY;
                imageSlider.style.transition = 'none'; // Disable transition during drag for smooth dragging
            });

            backgroundImageViewer.addEventListener('touchmove', (e) => {
                const touchCurrentX = e.touches[0].clientX;
                const touchCurrentY = e.touches[0].clientY;

                const deltaX = touchCurrentX - backgroundTouchStartX;
                const deltaY = Math.abs(touchCurrentY - backgroundTouchStartY);

                // Only allow horizontal drag if vertical deviation is small
                if (deltaY < BACKGROUND_MAX_VERTICAL_DEVIATION) {
                    e.preventDefault(); // Prevent default browser scrolling while dragging horizontally
                    // Calculate the new translateX based on drag
                    const currentOffsetPx = currentImageIndex * window.innerWidth;
                    const newOffsetPx = currentOffsetPx - deltaX;
                    imageSlider.style.transform = `translateX(-${newOffsetPx}px)`;
                }
            });

            backgroundImageViewer.addEventListener('touchend', (e) => {
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;

                const diffX = backgroundTouchStartX - touchEndX; // Positive for left swipe, negative for right swipe
                const diffY = Math.abs(backgroundTouchStartY - touchEndY);

                imageSlider.style.transition = 'transform 0.8s ease-in-out'; // Re-enable transition for snapping effect

                // Check for a significant horizontal swipe within vertical deviation limits
                if (Math.abs(diffX) > BACKGROUND_SWIPE_THRESHOLD_X && diffY < BACKGROUND_MAX_VERTICAL_DEVIATION) {
                    if (diffX > 0) { // Swiped left
                        // If input sequence is not full, a left swipe acts as 'a' input
                        if (inputSequence.length < MAX_INPUT_LENGTH) {
                            handleInput('a'); 
                        } else {
                            // If input sequence is full, left swipe just navigates images
                            currentImageIndex = (currentImageIndex + 1) % totalImages; 
                            slideImage(currentImageIndex);
                        }
                    } else { // Swiped right
                        // Right swipe always navigates images
                        currentImageIndex = (currentImageIndex - 1 + totalImages) % totalImages; 
                        slideImage(currentImageIndex);
                    }
                } else {
                    // Not a significant swipe, snap back to the currently displayed image
                    slideImage(currentImageIndex);
                }
            });

            // --- Quadrant Box Click/Tap Logic (REMOVED) ---
            // Removed click event listeners from individual boxes as per user request.
            // All input will now be handled by swipe gestures on the background.

            // Toggle input visibility button
            const toggleInputButton = document.getElementById('toggleInputButton');
            toggleInputButton.addEventListener('click', () => {
                if (mainContainer.style.display === 'none') {
                    mainContainer.style.display = 'grid'; // Show the grid
                    toggleInputButton.textContent = 'Sembunyikan Input';
                } else {
                    mainContainer.style.display = 'none'; // Hide the grid
                    toggleInputButton.textContent = 'Tampilkan Input';
                }
            });

            // Initial display of Gambar 1 when the page loads
            slideImage(currentImageIndex);
        });
    </script>
</body>
</html>
